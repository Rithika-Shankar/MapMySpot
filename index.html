<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MapMySpot - Professional</title>
  <style>
    /* Reset and base */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f9f9;
      color: #333;
    }
    /* Container and layout */
    #app {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    #sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    /* Logo placeholder */
    #logo {
      height: 50px;
      margin-bottom: 30px;
      font-weight: 700;
      font-size: 24px;
      color: #005792;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #005792;
      border-radius: 6px;
      user-select: none;
    }

    /* Login form */
    #loginForm {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }
    #loginForm input[type="email"],
    #loginForm input[type="password"] {
      padding: 10px;
      border: 1px solid #bbb;
      border-radius: 4px;
      font-size: 16px;
    }
    #loginForm button {
      background-color: #005792;
      color: white;
      border: none;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    #loginForm button:hover {
      background-color: #00406c;
    }

    /* After login UI */
    #controls {
      display: none;
      flex-direction: column;
      gap: 20px;
    }
    #controls label {
      font-weight: 600;
      margin-bottom: 6px;
      color: #555;
    }
    #locationInput,
    #vehicleSize {
      padding: 10px;
      font-size: 15px;
      border: 1px solid #bbb;
      border-radius: 4px;
      outline-offset: 2px;
      outline-color: #005792;
    }
    #searchSpotsBtn, #clearSpotsBtn {
      background-color: #0078d7;
      color: white;
      border: none;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s;
      width: 100%;
    }
    #searchSpotsBtn:hover {
      background-color: #005a9e;
    }
    #clearSpotsBtn:hover {
      background-color: #00406c;
    }

    /* Map container */
    #map {
      flex: 1;
    }

    /* Popup card */
    #spotPopup {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      border-radius: 8px;
      padding: 15px 20px;
      max-width: 300px;
      font-size: 14px;
      display: none;
      z-index: 10;
    }
    #spotPopup strong {
      color: #005792;
      display: block;
      margin-bottom: 6px;
      font-size: 16px;
    }
    #spotPopup div {
      margin-bottom: 6px;
      color: #444;
    }
    #navigateBtn {
      background-color: #005792;
      color: white;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    #navigateBtn:hover {
      background-color: #003f66;
    }

    /* Responsive */
    @media(max-width: 640px) {
      #app {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #ddd;
      }
      #spotPopup {
        bottom: 80px;
        left: 10px;
        transform: none;
        max-width: calc(100% - 20px);
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <div id="logo" aria-label="Company Logo Placeholder">
        LOGO
      </div>
      <form id="loginForm" aria-label="Login Form">
        <input type="email" id="email" placeholder="Email" required autocomplete="username" />
        <input type="password" id="password" placeholder="Password" required autocomplete="current-password" />
        <button type="submit">Login</button>
      </form>
      <div id="controls">
        <label for="locationInput">Search Location</label>
        <input type="text" id="locationInput" placeholder="Enter location" aria-label="Location search" />
        <label for="vehicleSize">Select Vehicle Size</label>
        <select id="vehicleSize" aria-label="Vehicle size selection">
          <option value="bike">Bike</option>
          <option value="compact">Compact</option>
          <option value="sedan" selected>Sedan</option>
          <option value="suv">SUV</option>
          <option value="large">Large</option>
        </select>
        <button id="searchSpotsBtn">Find Parking Spots</button>
        <button id="clearSpotsBtn">Clear Spots</button>
      </div>
    </aside>
    <main id="map"></main>

    <div id="spotPopup" role="dialog" aria-modal="true" aria-labelledby="spotAddress">
      <strong id="spotAddress">Address</strong>
      <div id="spotPrice">Price</div>
      <div id="spotDistance">Distance</div>
      <div id="spotETA">ETA</div>
      <button id="navigateBtn">Navigate</button>
    </div>
  </div>

  <script>
    // Map and markers
    let map;
    let markers = [];
    let directionsService;
    let directionsRenderer;
    let infoWindow;
    let selectedSpot = null;

    // Sample parking spots data with subtle colors
    const parkingSpots = [
      {
        pos: { lat: 40.751, lng: -73.994 },
        address: "25 W 39th St, New York, NY",
        size: "compact",
        price: 4,
      },
      {
        pos: { lat: 40.749, lng: -73.985 },
        address: "200 Park Ave, New York, NY",
        size: "sedan",
        price: 6,
      },
      {
        pos: { lat: 40.752, lng: -73.978 },
        address: "10 E 42nd St, New York, NY",
        size: "suv",
        price: 8,
      },
      {
        pos: { lat: 40.754, lng: -73.993 },
        address: "350 5th Ave, New York, NY",
        size: "large",
        price: 10,
      },
      {
        pos: { lat: 40.753, lng: -73.981 },
        address: "405 Lexington Ave, New York, NY",
        size: "bike",
        price: 0,
      },
    ];

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.751, lng: -73.99 },
        zoom: 15,
        mapTypeControl: false,
        streetViewControl: false,
      });

      infoWindow = new google.maps.InfoWindow();

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        map: map,
        suppressMarkers: true,
        polylineOptions: {
          strokeColor: "#005792",
          strokeWeight: 4,
        }
      });

      // Event listeners
      document.getElementById('searchSpotsBtn').onclick = () => {
        clearMarkers();
        const size = document.getElementById('vehicleSize').value;
        showParkingSpots(size);
      };
      document.getElementById('clearSpotsBtn').onclick = () => {
        clearMarkers();
        hidePopup();
        directionsRenderer.set('directions', null);
      };

      // Location search autocomplete (basic)
      const locationInput = document.getElementById('locationInput');
      locationInput.addEventListener('keydown', e => {
        if(e.key === 'Enter'){
          e.preventDefault();
          geocodeAddress(locationInput.value);
        }
      });

      // Initially hide controls until login
      document.getElementById('controls').style.display = 'none';

      // Login form handler
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', e => {
        e.preventDefault();
        // Simple mock login, just check non-empty
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        if(email && password) {
          loginForm.style.display = 'none';
          document.getElementById('controls').style.display = 'flex';
        } else {
          alert('Please enter valid email and password.');
        }
      });
    }

    // Geocode address and center map
    function geocodeAddress(address) {
      if (!address.trim()) return;
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ address: address }, (results, status) => {
        if (status === "OK" && results[0]) {
          map.setCenter(results[0].geometry.location);
          map.setZoom(16);
        } else {
          alert('Location not found.');
        }
      });
    }

    // Show spots filtered by vehicle size
    function showParkingSpots(size) {
      const filteredSpots = parkingSpots.filter(spot => canFitVehicle(spot.size, size));

      if (filteredSpots.length === 0) {
        alert('No parking spots available for selected vehicle size.');
        return;
      }

      filteredSpots.forEach(spot => {
        const marker = new google.maps.Marker({
          position: spot.pos,
          map: map,
          title: spot.address,
          icon: getIconForSize(spot.size),
        });

        marker.addListener('click', () => {
          showPopup(spot);
        });

        markers.push(marker);
      });
    }

    // Determine if spot can fit vehicle size (simplified logic)
    function canFitVehicle(spotSize, vehicleSize) {
      const sizeRank = { bike: 1, compact: 2, sedan: 3, suv: 4, large: 5 };
      return sizeRank[spotSize] >= sizeRank[vehicleSize];
    }

    // Subtle colored icons for vehicle sizes
    function getIconForSize(size) {
      const colors = {
        bike: '#4CAF50',      // green
        compact: '#2196F3',   // blue
        sedan: '#FF9800',     // orange
        suv: '#F44336',       // red
        large: '#9E9E9E'      // gray
      };
      return {
        path: google.maps.SymbolPath.CIRCLE,
        fillColor: colors[size] || '#607D8B',
        fillOpacity: 0.8,
        strokeColor: '#fff',
        strokeWeight: 1.5,
        scale: 10,
      };
    }

    // Clear all markers
    function clearMarkers() {
      markers.forEach(m => m.setMap(null));
      markers = [];
    }

    // Show popup with pricing & ETA & navigate button
    const spotPopup = document.getElementById('spotPopup');
    const spotAddress = document.getElementById('spotAddress');
    const spotPrice = document.getElementById('spotPrice');
    const spotDistance = document.getElementById('spotDistance');
    const spotETA = document.getElementById('spotETA');
    const navigateBtn = document.getElementById('navigateBtn');

    function showPopup(spot) {
      selectedSpot = spot;
      spotAddress.textContent = spot.address;
      spotPrice.textContent = spot.price === 0 ? "Price: Free / hour" : `Price: $${spot.price} / hour`;
      spotDistance.textContent = "Distance: calculating...";
      spotETA.textContent = "ETA: calculating...";
      spotPopup.style.display = 'block';

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => {
            const userLoc = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
            const spotLoc = new google.maps.LatLng(spot.pos.lat, spot.pos.lng);
            const service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix(
              {
                origins: [userLoc],
                destinations: [spotLoc],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
              },
              (response, status) => {
                if (status === "OK") {
                  const element = response.rows[0].elements[0];
                  spotDistance.textContent = `Distance: ${element.distance.text}`;
                  spotETA.textContent = `ETA: ${element.duration.text}`;
                } else {
                  spotDistance.textContent = "Distance: unavailable";
                  spotETA.textContent = "ETA: unavailable";
                }
              }
            );
          },
          () => {
            spotDistance.textContent = "Distance: location denied";
            spotETA.textContent = "ETA: location denied";
          }
        );
      } else {
        spotDistance.textContent = "Distance: unsupported";
        spotETA.textContent = "ETA: unsupported";
      }
    }

    function hidePopup() {
      spotPopup.style.display = 'none';
      selectedSpot = null;
    }

    navigateBtn.onclick = () => {
      if (!selectedSpot) return;
      if (!navigator.geolocation) {
        alert("Geolocation not supported.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => {
          const origin = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
          const destination = new google.maps.LatLng(selectedSpot.pos.lat, selectedSpot.pos.lng);

          directionsService.route(
            {
              origin,
              destination,
              travelMode: google.maps.TravelMode.DRIVING,
            },
            (result, status) => {
              if (status === "OK") {
                directionsRenderer.setDirections(result);
              } else {
                alert("Directions request failed due to " + status);
              }
            }
          );
        },
        () => alert('Failed to get your location')
      );
    };
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
  </script>
</body>
</html>
